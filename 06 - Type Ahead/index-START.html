<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
<script>
  const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

  // DOM elements
  const search = document.querySelector('input.search');
  const suggestions = document.querySelector('.suggestions');

  let data;
  let cities = [];
  let searchText = '';

  // ç²å– API è³‡æ–™
  getData();
  // ç›£è½æœå°‹æ¬„ä½å…§å®¹
  search.addEventListener('input', (e) => {
    searchText = e.target.value.toLowerCase();
    // æª¢æŸ¥è³‡æ–™ä¸­æ˜¯å¦åŒ…å«æœå°‹çš„é—œéµå­—
    cities = data.filter(cur => cur.city.toLowerCase().includes(searchText) || cur.state.toLowerCase().includes(searchText));

    printResults();
  });


  function getData() {
    const request = new XMLHttpRequest();
    request.open('get', endpoint, true);
    request.send(null);
    request.addEventListener('readystatechange', (e) => {
      if(e.target.readyState === 4 && e.target.status === 200) {
        data = JSON.parse(request.responseText);
      } else if(e.target.readyState === 4) {
        console.log(`Failed to fetch data.`);
      }
    });
  }
  
  // æ¸²æŸ“é é¢
  function printResults() {
    suggestions.innerHTML = '';
    if(searchText === '') {
      suggestions.insertAdjacentHTML('beforeend',`<li>Filter for a city</li><li>or a state</li>`);
    } else if (cities.length === 0) {
      suggestions.insertAdjacentHTML('beforeend',`<li>Result not found.</li>`);
    } else {
      cities.forEach(cur => {
        // ç‚ºæ•¸å­—åŠ ä¸Šåƒä½æ•¸é€—è™Ÿ
        const formatedPopulation = Number(cur.population).toLocaleString();
        suggestions.insertAdjacentHTML('beforeend', 
          `
            <li>
              <span class="name">${cur.city}, ${cur.state}</span>
              <span class="population">${formatedPopulation}</span>
            </li>
          `
        );
      });
    }
  }

  // åŠŸèƒ½èˆ‡é æœŸæ¸›å°‘äº† highlightï¼Œå…¶é¤˜å¤§è‡´ä¸Šéƒ½æœ‰åšåˆ°
  // æ¯”èµ· Wes Bos, æˆ‘é‚„ä¸æœƒ fetchï¼Œæ‰€ä»¥åªç”¨äº† XMLHttpRequestï¼›åŒæ™‚å› å°šæœªå­¸ Regular Expressionï¼Œæ‰€ä»¥ highlight éƒ¨åˆ†åšä¸å‡ºä¾†
</script>
  </body>
</html>
